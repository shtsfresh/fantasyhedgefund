@inject BLL.Interfaces.ITransactionService _transactionService;
@inject BLL.Interfaces.IAssetService _assetService;
@using System.Security.Claims;
@{
    ViewData["Title"] = "Portfolio";
    Guid userId = Guid.Parse(User.FindFirst(ClaimTypes.NameIdentifier).Value.ToString());
    List<BOL.TransactionBOL> transactions = await _transactionService.GetAllForUser(userId);
    List<BOL.AssetBOL> holdings = (await _assetService.GetHoldingsForUser(userId)).Where(h => h.Class != BOL.Enums.EAssetClass.Cash).ToList();
    double TotalFundValue = await _assetService.GetTotalHoldingValueForUser(userId);
    double CashOnHand = await _assetService.GetAmountByAssetClassForUser(BOL.Enums.EAssetClass.Cash, userId);
    double Performance = await _assetService.GetPerformanceForUser(userId) * 100;
}

<div class="row">
    <div class="col-12">
        <h1>
            Your Fund - Portfolio
        </h1>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-4">
        <div class="card text-white bg-dark mb-3 w-100">
            <div class="card-header">Fund Current Value $@TotalFundValue.ToString("0.00")</div>
            <div class="card-body">
                <h5 class="card-title">@Performance.ToString("0.00")%</h5>
                <p class="card-text">Fund performance KPI</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-dark mb-3">
            <div class="card-header">$10 will be deposited on the next Monday</div>
            <div class="card-body">
                <h5 class="card-title">$@CashOnHand.ToString("0.00")</h5>
                <p class="card-text">Cash On Hand</p>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <h1>
            Holdings
        </h1>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th scope="col">Asset Class</th>
                    <th scope="col">Asset Name</th>
                    <th scope="col">Quantity</th>
                    <th scope="col">Current Price</th>
                    <th scope="col">Current Value</th>
                    <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
                @foreach (BOL.AssetBOL holding in holdings)
                {
                    <tr>
                        <th>@holding.Class</th>
                        <th>@holding.Name (@holding.ShortName)</th>
                        <th>@holding.Quantity</th>
                        <th>$@holding.Price</th>
                        <th>$@((holding.Quantity*holding.Price).ToString("0.00"))</th>
                        <th><a href="~/asset/@holding.Id.ToString()/sell" class="btn btn-sm btn-outline-danger">Sell</a></th>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <a href="~/asset/trade" class="btn btn-success w-100" type="button">
            <i class="fa fa-money-bill-trend-up me-2"></i> Trade
        </a>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <h1>
            Ledger
        </h1>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Date & Time</th>
                    <th scope="col">Action</th>
                    <th scope="col">Asset Name</th>
                    <th scope="col">Quantity</th>
                    <th scope="col">Price Acted</th>
                    <th scope="col">Total Amount</th>
                </tr>
            </thead>
            <tbody>
                @foreach (BOL.TransactionBOL transaction in transactions)
                {
                    <tr>
                        <th>
                            @transaction.Date
                        </th>
                        @{
                            if (transaction.Type == BOL.Enums.ETransactionType.Buy)
                            {
                                <th>Buy</th>
                            }
                            else if (transaction.Type == BOL.Enums.ETransactionType.Sell)
                            {
                                <th>Sell</th>
                            }
                            else if (transaction.Type == BOL.Enums.ETransactionType.Draw)
                            {
                                <th>Draw</th>
                            }
                        }
                        <th>@transaction.AssetLongName (@transaction.AssetShortName)</th>
                        <th>@transaction.Quantity.ToString("0.00")</th>
                        <th>@transaction.Price.ToString("0.00")</th>
                        <th>@((transaction.Price*transaction.Quantity).ToString("0.00"))</th>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>